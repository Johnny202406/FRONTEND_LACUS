<div class="shadow-md sm:rounded-lg max-w-2xl flex-none">
  <div class="flex items-center justify-between w-full flex-wrap py-4 bg-white px-2 gap-2">
    <p-button label="Agregar " (onClick)="brand.showDialog()" />
    <p-floatlabel class="w-64" variant="on">
      <p-select
        [options]="brand.enabled"
        [(ngModel)]="brand.selectedEnabled"
        optionLabel="label"
        [showClear]="true"
        class="w-64"
      >
        <ng-template #selectedItem let-selectedEstado>
          <div class="flex items-center gap-2">
            <div class="truncate">{{ selectedEstado.label }}</div>
          </div>
        </ng-template>

        <ng-template let-estado #item>
          <div class="flex items-center gap-2">
            <div>{{ estado.label }}</div>
          </div>
        </ng-template>
      </p-select>
      <label for="on_label">Estado</label>
    </p-floatlabel>
    <p-floatlabel variant="on">
      <input
        pInputText
        id="on_label"
        [(ngModel)]="brand.searchByName"
        classs="w-64"
        autocomplete="off"
      />
      <label for="on_label">Búsqueda por nombre</label>
    </p-floatlabel>
    <p-button label="Buscar" severity="danger" (click)="brand.search()" [rounded]="true" />
    <p-button
      icon="pi pi-refresh"
      label="Resetear"
      [raised]="true"
      severity="danger"
      [rounded]="true"
      (onClick)="brand.resetFilters()"
    />
  </div>
  @if (brand.brands.length > 0) {
  <p-table
    #dt
    showGridlines
    [value]="brand.brands"
    [tableStyle]="{ 'max-width': '100%' }"
    [rows]="brand.pageSize"
    [paginator]="true"
    [rowsPerPageOptions]="brand.enumPageSize"
    [totalRecords]="brand.count"
    (onLazyLoad)="brand.lazyLoad($event)"
    [lazy]="true"
    [loading]="brand.loading"
  >
    <ng-template pTemplate="header">
      <tr>
        @for (item of brand.headers; track $index) {
        <th [style.width]="item.width">{{ item.label }}</th>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-marca>
      @if(!brand.loading){
      <tr>
        <td>{{ marca.nombre }}</td>
        <td>
          <div class="flex items-center justify-center h-full w-full">
            <p-image
              [src]="marca.secure_url"
              [alt]="marca.nombre"
              class="w-10 h-10 object-contain rounded object-center"
              [preview]="true"
            ></p-image>
          </div>
        </td>
        <td>
          <div class="flex items-center justify-center h-full w-full">
            <p-checkbox
              [ngModel]="marca.habilitado"
              [binary]="true"
              (onChange)="brand.enabledDisabled(marca)"
            />
          </div>
        </td>
        <td>
          <div
            class="text-rojo cursor-pointer flex justify-center"
            (click)="brand.updateBrand(marca)"
          >
            <i class="pi pi-file-edit" style="font-size: 1.25rem; font-weight: bolder"></i>
          </div>
        </td>
      </tr>
      }@else{
      <tr style="height: 46px">
        @for (item of brand.headers; track $index) {
        <td>
          <p-skeleton />
        </td>
        }
      </tr>
      }
    </ng-template>
  </p-table>
  }@else {
  <p class="px-2 py-4">No hay registros de Marcas...</p>
  }
</div>

<!-- MODAL -->
<p-dialog
  [header]="brand.selectedBrand ? 'Actualizar Marca' : 'Crear Marca'"
  [modal]="true"
  [(visible)]="brand.visibleModal"
  [style]="{ width: '25rem', height: 'auto' }"
>
  <form [formGroup]="brand.form" (ngSubmit)="brand.operationBrand()">
    <div class="flex flex-col items-start gap-4 mb-4">
      <label for="name" class="font-semibold w-24">Nombre</label>
      <input pInputText type="text" id="name" formControlName="name" class="flex-auto" />
      <small class="text-red-500">
        * @if (brand.form.get('name')?.invalid && brand.form.get('name')?.touched) { El nombre es
        obligatorio y debe tener menos de 100 caracteres. }
      </small>
    </div>

    <div class="flex flex-col items-start gap-4 mb-4">
      <label for="name" class="font-semibold w-24">Nombre</label>
      <p-fileUpload
        #fu
        mode="advanced"
        [customUpload]="true"
        [multiple]="false"
        accept="image/*"
        [maxFileSize]="200000"
        [fileLimit]="1"
        invalidFileSizeMessageSummary=" {0}: Tamaño de archivo inválido "
        invalidFileSizeMessageDetail=" El tamaño máximo permitido es {0}. "
        invalidFileTypeMessageSummary=" {0}: Tipo de archivo inválido "
        invalidFileTypeMessageDetail=" Tipos de archivo permitidos: {0}. "
        invalidFileLimitMessageDetail=" El límite es de {0} como máximo. "
        invalidFileLimitMessageSummary="{0}: Límite de archivos excedido"
        [showUploadButton]="false"
        [showCancelButton]="false"
        (onSelect)="brand.onSelect($event)"
        (onRemove)="brand.onRemove($event)"
      >
        <ng-template #empty>
          <div>Arrastra y suelta un archivo aquí o haz clic para seleccionar.</div>
        </ng-template>
      </p-fileUpload>
      <small class="text-red-500">
        * @if (brand.form.get('file')?.invalid && brand.form.get('file')?.touched) { La imagen es
        requerida }
      </small>
    </div>

    <div class="flex justify-end gap-2 bottom-4 right-4">
      <p-button label="Cancelar" severity="secondary" (click)="brand.showDialog()" />
      <p-button
        [label]="brand.selectedBrand ? 'Actualizar' : 'Crear'"
        [type]="'submit'"
        [disabled]="brand.form.invalid"
      ></p-button>
    </div>
  </form>
</p-dialog>
